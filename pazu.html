<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±ªè¯é»æ•¸å¤§è½‰ç›¤</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-gold: #d4af37;
            --dark-bg: #1a1a1a;
            --accent-red: #e63946;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* éŠæˆ²å€åŸŸä½ˆå±€ */
        .game-container {
            position: relative;
            text-align: center;
        }

        h1 {
            color: var(--primary-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            cursor: pointer; /* é»æ“Šæ¨™é¡Œå¯é–‹å•Ÿå¾Œå° */
            margin-bottom: 10px;
        }

        .points-display {
            font-size: 1.5rem;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid var(--primary-gold);
        }

        /* è½‰ç›¤ä¸»é«”è¨­è¨ˆ */
        .wheel-wrapper {
            position: relative;
            width: 400px;
            height: 400px;
            border: 10px solid var(--primary-gold);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5), 0 0 15px var(--primary-gold);
        }

        #wheelCanvas {
            width: 100%;
            height: 100%;
            transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1);
        }

        /* æŒ‡é‡ */
        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 50px;
            background: var(--accent-red);
            clip-path: polygon(50% 100%, 0% 0%, 100% 0%);
            z-index: 10;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .spin-btn {
            margin-top: 30px;
            padding: 15px 50px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark-bg);
            background: linear-gradient(45deg, var(--primary-gold), #fff);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        .spin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.6);
        }

        .spin-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        /* å¾Œå°ç®¡ç†é¢æ¿ */
        #adminPanel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            background: #222;
            padding: 20px;
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            border: 1px solid #444;
            text-align: center;
        }

        input {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 5px;
            width: 80%;
        }

        .close-admin {
            background: var(--accent-red);
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .overlay {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            z-index: 90;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1 onclick="toggleAdmin()">ğŸ’ å¹¸é‹é»æ•¸å¤§è½‰ç›¤ ğŸ’</h1>
        <div class="points-display">å‰©é¤˜é»æ•¸ï¼š<span id="userPoints">1000</span></div>
        
        <div class="wheel-wrapper">
            <div class="pointer"></div>
            <canvas id="wheelCanvas" width="800" height="800"></canvas>
        </div>

        <button class="spin-btn" id="spinBtn" onclick="spinWheel()">
            ç«‹å³æŠ½ç (<span id="costDisplay">50</span> é»)
        </button>
    </div>

    <div class="overlay" id="overlay" onclick="toggleAdmin()"></div>
    <div id="adminPanel">
        <div class="admin-header">
            <h3>âš™ï¸ è½‰ç›¤æ§ç›¤å¾Œå°</h3>
            <button class="close-admin" onclick="toggleAdmin()">é—œé–‰</button>
        </div>
        <div style="margin-top: 15px;">
            <label>æ¯æ¬¡æŠ½çæ¶ˆè€—ï¼š</label>
            <input type="number" id="inputCost" style="width: 60px;" value="50" onchange="updateSettings()">
        </div>
        <table>
            <thead>
                <tr>
                    <th>çå“åç¨±</th>
                    <th>é…ç‡æ¬Šé‡</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="prizeTableBody">
                </tbody>
        </table>
        <button onclick="addNewPrize()" style="margin-top:10px; background: #28a745; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">+ æ–°å¢çé …</button>
    </div>

    <script>
        // --- Firebase åˆå§‹åŒ–å€å¡Š (ä¿ç•™çµæ§‹) ---
        // const firebaseConfig = { ... };
        // firebase.initializeApp(firebaseConfig);
        // ------------------------------------

        // åˆå§‹éŠæˆ²è¨­å®š
        let settings = {
            cost: 50,
            prizes: [
                { name: "100 é»æ•¸", weight: 10, color: "#d4af37" },
                { name: "è¬è¬åƒèˆ‡", weight: 50, color: "#333333" },
                { name: "500 é»æ•¸", weight: 5, color: "#c0c0c0" },
                { name: "iPhone 15", weight: 1, color: "#e63946" },
                { name: "10 é»æ•¸", weight: 80, color: "#444444" },
                { name: "ç¥ç§˜ç¦è¢‹", weight: 20, color: "#6a0dad" }
            ]
        };

        let currentPoints = 1000;
        let isSpinning = false;
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');

        // åˆå§‹åŒ–ç¹ªè£½
        function init() {
            drawWheel();
            updateUI();
            refreshAdminTable();
        }

        function updateUI() {
            document.getElementById('userPoints').innerText = currentPoints;
            document.getElementById('costDisplay').innerText = settings.cost;
            document.getElementById('inputCost').value = settings.cost;
        }

        // ç¹ªè£½è½‰ç›¤
        function drawWheel() {
            const prizeCount = settings.prizes.length;
            const arc = (2 * Math.PI) / prizeCount;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            settings.prizes.forEach((prize, i) => {
                const angle = i * arc;
                
                // ç•«æ‰‡å½¢
                ctx.beginPath();
                ctx.fillStyle = prize.color;
                ctx.moveTo(400, 400);
                ctx.arc(400, 400, 380, angle, angle + arc);
                ctx.fill();
                ctx.stroke();

                // ç•«æ–‡å­—
                ctx.save();
                ctx.translate(400, 400);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 30px Arial";
                ctx.fillText(prize.name, 350, 10);
                ctx.restore();
            });
        }

        // æŠ½çé‚è¼¯ï¼šæ ¹æ“šæ¬Šé‡è¨ˆç®—çµæœ
        function spinWheel() {
            if (isSpinning) return;
            if (currentPoints < settings.cost) {
                Swal.fire("é»æ•¸ä¸è¶³", "è«‹å…ˆå„²å€¼é»æ•¸ï¼", "error");
                return;
            }

            currentPoints -= settings.cost;
            updateUI();
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;

            // æ¬Šé‡æ¼”ç®—æ³•
            const totalWeight = settings.prizes.reduce((sum, p) => sum + p.weight, 0);
            let random = Math.random() * totalWeight;
            let winningIndex = 0;

            for (let i = 0; i < settings.prizes.length; i++) {
                random -= settings.prizes[i].weight;
                if (random <= 0) {
                    winningIndex = i;
                    break;
                }
            }

            // è¨ˆç®—æ—‹è½‰è§’åº¦ (é€†æ™‚é‡è¨ˆç®—è£œæ­£)
            const prizeCount = settings.prizes.length;
            const arcDegree = 360 / prizeCount;
            const extraSpins = 3600; // æ—‹è½‰ 10 åœˆ
            // è¨ˆç®—ä¸­çå€åŸŸçš„ä¸­å¿ƒé»è§’åº¦
            const targetDegree = extraSpins + (360 - (winningIndex * arcDegree + arcDegree / 2));

            canvas.style.transform = `rotate(${targetDegree}deg)`;

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
                const winPrize = settings.prizes[winningIndex];
                
                Swal.fire({
                    title: 'æ­å–œä¸­çï¼',
                    text: `æ‚¨ç²å¾—äº†ï¼š${winPrize.name}`,
                    icon: 'success',
                    confirmButtonColor: '#d4af37'
                });
                
                // æ—‹è½‰é‡ç½®ï¼ˆç„¡æ„Ÿé‡ç½®è§’åº¦é˜²æ­¢ä¸‹æ¬¡åå·®ï¼‰
                canvas.style.transition = 'none';
                canvas.style.transform = `rotate(${targetDegree % 360}deg)`;
                setTimeout(() => { canvas.style.transition = 'transform 5s cubic-bezier(0.15, 0, 0.15, 1)'; }, 50);
            }, 5000);
        }

        // --- å¾Œå°ç®¡ç†åŠŸèƒ½ ---
        function toggleAdmin() {
            const panel = document.getElementById('adminPanel');
            const overlay = document.getElementById('overlay');
            const isVisible = panel.style.display === 'block';
            panel.style.display = isVisible ? 'none' : 'block';
            overlay.style.display = isVisible ? 'none' : 'block';
        }

        function refreshAdminTable() {
            const tbody = document.getElementById('prizeTableBody');
            tbody.innerHTML = '';
            settings.prizes.forEach((prize, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td><input type="text" value="${prize.name}" onchange="editPrize(${index}, 'name', this.value)"></td>
                        <td><input type="number" value="${prize.weight}" onchange="editPrize(${index}, 'weight', this.value)"></td>
                        <td><button onclick="deletePrize(${index})" style="background:var(--accent-red); border:none; color:white; border-radius:3px;">åˆªé™¤</button></td>
                    </tr>
                `;
            });
        }

        function editPrize(index, field, value) {
            if (field === 'weight') value = parseFloat(value);
            settings.prizes[index][field] = value;
            drawWheel();
        }

        function addNewPrize() {
            settings.prizes.push({ name: "æ–°çé …", weight: 10, color: getRandomColor() });
            refreshAdminTable();
            drawWheel();
        }

        function deletePrize(index) {
            if (settings.prizes.length <= 2) return Swal.fire("æç¤º", "æœ€å°‘éœ€ä¿ç•™å…©å€‹çé …", "warning");
            settings.prizes.splice(index, 1);
            refreshAdminTable();
            drawWheel();
        }

        function updateSettings() {
            settings.cost = parseInt(document.getElementById('inputCost').value);
            updateUI();
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) color += letters[Math.floor(Math.random() * 16)];
            return color;
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
