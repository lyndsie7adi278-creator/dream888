<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>DREAM ç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <div id="lockScreen" class="fixed inset-0 bg-slate-950 z-[100] flex items-center justify-center">
        <div class="bg-slate-800 p-8 rounded-3xl shadow-2xl w-80 text-center border border-slate-700">
            <h2 class="text-xl font-bold mb-4">ç®¡ç†å“¡é©—è­‰</h2>
            <input type="password" id="adminPass" placeholder="è¼¸å…¥å¯†ç¢¼" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mb-4 text-center text-yellow-500">
            <button onclick="checkPass()" class="w-full bg-yellow-600 text-slate-900 py-3 rounded-xl font-bold">ç™»å…¥ç³»çµ±</button>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-8">
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-black gold-text">é»æ•¸æ§ç®¡ä¸­å¿ƒ</h1>
            <button onclick="logout()" class="text-slate-500 text-sm">ç™»å‡º</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700">
                <h2 class="font-bold mb-4 flex items-center">ğŸ‘¥ ç©å®¶æ¸…å–®</h2>
                <div id="userList" class="space-y-4"></div>
            </div>

            <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700">
                <h2 class="font-bold mb-4 flex items-center">ğŸ ä¸Šæ¶å•†å“</h2>
                <div class="space-y-3">
                    <input type="text" id="pName" placeholder="å•†å“åç¨±" class="w-full bg-slate-900 border-slate-700 rounded-xl p-3 text-sm">
                    <input type="number" id="pPrice" placeholder="é»æ•¸" class="w-full bg-slate-900 border-slate-700 rounded-xl p-3 text-sm">
                    <input type="text" id="pImg" placeholder="åœ–ç‰‡URL" class="w-full bg-slate-900 border-slate-700 rounded-xl p-3 text-sm">
                    <button onclick="addProduct()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">ç¢ºèªä¸Šæ¶</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "0805"; // <-- è«‹ä¿®æ”¹æ­¤è™•
        const firebaseConfig = {
  apiKey: "AIzaSyDJIhgbbCJv3f8y9xdSHUCTfJi_sjKBOqs",
  authDomain: "dreampoint-b37df.firebaseapp.com",
  projectId: "dreampoint-b37df",
  storageBucket: "dreampoint-b37df.firebasestorage.app",
  messagingSenderId: "454938973111",
  appId: "1:454938973111:web:2191261a3175c8115d0e32",
  measurementId: "G-H4L410HB29"
};
        const GAS_URL = "AKfycbwuvNZo2rJ3kkcWPoKfBOiw7megpwxSu5X9rIEuxjcgDYMJ5ElWJekTQ_H7Xz-o0oQ";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function checkPass() {
            if(document.getElementById('adminPass').value === ADMIN_PASSWORD) {
                document.getElementById('lockScreen').style.display = 'none';
                sessionStorage.setItem('isDREAMAdmin', 'true');
                loadUsers();
            } else { alert('å¯†ç¢¼éŒ¯èª¤'); }
        }

        if(sessionStorage.getItem('isDREAMAdmin') === 'true') {
            document.getElementById('lockScreen').style.display = 'none';
            loadUsers();
        }

        function loadUsers() {
            db.ref('users').on('value', snap => {
                const users = snap.val();
                const list = document.getElementById('userList');
                list.innerHTML = '';
                for (let id in users) {
                    list.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-slate-900 rounded-2xl border border-slate-700">
                            <div>
                                <p class="text-[10px] text-slate-500 font-mono">${id.substring(0,10)}...</p>
                                <p class="text-xl font-black text-yellow-500">${users[id].points || 0}</p>
                            </div>
                            <div class="space-x-1">
                                <button onclick="addPoints('${id}', 100)" class="bg-slate-700 px-3 py-1 rounded-lg text-xs">+100</button>
                                <button onclick="addPoints('${id}', -100)" class="bg-slate-800 px-3 py-1 rounded-lg text-xs text-slate-500">-100</button>
                            </div>
                        </div>`;
                }
            });
        }

        function addPoints(uid, amt) {
            db.ref('users/' + uid + '/points').transaction(p => (p || 0) + amt, (err, comm, snap) => {
                if(comm) {
                    const msg = `ğŸ”” é»æ•¸è®Šå‹•é€šçŸ¥\nç®¡ç†å“¡èª¿æ•´ï¼š${amt > 0 ? '+' : ''}${amt}\nç›®å‰å‰©é¤˜ï¼š${snap.val()} é»`;
                    fetch(`${GAS_URL}?userId=${uid}&msg=${encodeURIComponent(msg)}`, { mode: 'no-cors' });
                }
            });
        }

        function addProduct() {
            const name = document.getElementById('pName').value;
            const price = parseInt(document.getElementById('pPrice').value);
            const img = document.getElementById('pImg').value;
            if(name && price) {
                db.ref('products').push({ name, price, img });
                alert('ä¸Šæ¶æˆåŠŸ');
            }
        }

        function logout() { sessionStorage.clear(); location.reload(); }
    </script>
</body>
</html>
