<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><title>DREAM ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-6">
    <div id="lockScreen" class="fixed inset-0 bg-slate-950 z-[100] flex items-center justify-center">
        <div class="bg-slate-800 p-8 rounded-3xl w-80 text-center border border-slate-700 shadow-2xl">
            <h2 class="text-xl font-bold mb-4 text-yellow-500">ADMIN LOGIN</h2>
            <input type="password" id="adminPass" placeholder="å¯†ç¢¼ 0805" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 mb-4 text-center text-yellow-500 outline-none">
            <button onclick="checkPass()" class="w-full bg-yellow-600 text-slate-900 py-3 rounded-xl font-bold">é€²å…¥ç³»çµ±</button>
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-yellow-500">DREAM CONTROL</h1>
            <nav class="bg-slate-800 p-1 rounded-xl flex gap-1">
                <button onclick="tab('u')" id="bu" class="px-6 py-2 rounded-lg bg-yellow-600 text-slate-900 font-bold text-sm">æœƒå“¡ç®¡ç†</button>
                <button onclick="tab('p')" id="bp" class="px-6 py-2 rounded-lg text-slate-400 font-bold text-sm">å•†åŸç®¡ç†</button>
            </nav>
        </header>

        <div id="tu" class="bg-slate-800 rounded-3xl border border-slate-700 overflow-hidden shadow-2xl">
            <table class="w-full text-left">
                <thead class="bg-slate-900 text-slate-500 text-xs uppercase tracking-wider">
                    <tr><th class="px-6 py-4">ç©å®¶æš±ç¨± / ID</th><th class="px-6 py-4">é»æ•¸é¤˜é¡</th><th class="px-6 py-4 text-right">èª¿æ•´ (é€å‡ºå¾Œæ¨æ’­)</th></tr>
                </thead>
                <tbody id="userTable" class="divide-y divide-slate-700"></tbody>
            </table>
        </div>

        <div id="tp" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 h-fit sticky top-6 shadow-xl">
                <h2 id="fTitle" class="font-bold mb-4 text-yellow-500">ğŸ å•†å“ç®¡ç†</h2>
                <input type="hidden" id="editId">
                <div class="space-y-3">
                    <input type="text" id="pCat" placeholder="åˆ†é¡" class="w-full bg-slate-900 border-slate-700 rounded-lg p-3 text-sm">
                    <input type="text" id="pName" placeholder="å•†å“åç¨±" class="w-full bg-slate-900 border-slate-700 rounded-lg p-3 text-sm">
                    <input type="number" id="pPrice" placeholder="é»æ•¸" class="w-full bg-slate-900 border-slate-700 rounded-lg p-3 text-sm">
                    <input type="text" id="pImg" placeholder="åœ–ç‰‡é€£çµ" class="w-full bg-slate-900 border-slate-700 rounded-lg p-3 text-sm">
                    <textarea id="pDesc" placeholder="å•†å“ä»‹ç´¹" class="w-full bg-slate-900 border-slate-700 rounded-lg p-3 text-sm h-24"></textarea>
                    <button onclick="save()" class="w-full bg-yellow-600 text-slate-900 py-3 rounded-xl font-bold shadow-lg">å„²å­˜å•†å“</button>
                    <button onclick="reset()" class="w-full text-slate-500 text-xs">æ¸…ç©ºé‡å¡«</button>
                </div>
            </div>
            <div class="lg:col-span-2 grid grid-cols-1 gap-4" id="pList"></div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "0805", GAS_URL = "https://script.google.com/macros/s/AKfycbwuvNZo2rJ3kkcWPoKfBOiw7megpwxSu5X9rIEuxjcgDYMJ5ElWJekTQ_H7Xz-o0oQ/exec";
        const firebaseConfig = { apiKey: "AIzaSyDJIhgbbCJv3f8y9xdSHUCTfJi_sjKBOqs", authDomain: "dreampoint-b37df.firebaseapp.com", projectId: "dreampoint-b37df", databaseURL: "https://dreampoint-b37df-default-rtdb.firebaseio.com/", storageBucket: "dreampoint-b37df.firebasestorage.app", messagingSenderId: "454938973111", appId: "1:454938973111:web:2191261a3175c8115d0e32" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        function checkPass() { if(document.getElementById('adminPass').value === ADMIN_PASSWORD) { document.getElementById('lockScreen').style.display = 'none'; sessionStorage.setItem('adm', '1'); load(); } else alert('éŒ¯'); }
        if(sessionStorage.getItem('adm')==='1') { document.getElementById('lockScreen').style.display='none'; load(); }
        function tab(t) { document.getElementById('tu').classList.toggle('hidden', t!=='u'); document.getElementById('tp').classList.toggle('hidden', t!=='p'); document.getElementById('bu').className = t==='u' ? 'px-6 py-2 rounded-lg bg-yellow-600 text-slate-900 font-bold text-sm' : 'px-6 py-2 rounded-lg text-slate-400 font-bold text-sm'; document.getElementById('bp').className = t==='p' ? 'px-6 py-2 rounded-lg bg-yellow-600 text-slate-900 font-bold text-sm' : 'px-6 py-2 rounded-lg text-slate-400 font-bold text-sm'; }
        function load() {
            db.ref('users').on('value', s => { const u = s.val(), t = document.getElementById('userTable'); t.innerHTML = ''; for(let id in u) { t.innerHTML += `<tr class="border-b border-slate-700 hover:bg-slate-800/50"><td class="px-6 py-4 font-bold text-yellow-500">${u[id].name || 'æœªåŒæ­¥'}<br><span class="text-[9px] text-slate-500 font-mono">${id}</span></td><td class="px-6 py-4 text-xl font-black">${u[id].points || 0}</td><td class="px-6 py-4 text-right"><input type="number" id="in-${id}" placeholder="+/-" class="bg-slate-900 w-24 p-2 rounded-lg text-center border border-slate-700 mr-2"><button onclick="adj('${id}')" class="bg-white text-black px-4 py-2 rounded-lg font-bold">åŸ·è¡Œ</button></td></tr>`; } });
            db.ref('products').on('value', s => { const p = s.val(), l = document.getElementById('pList'); l.innerHTML = ''; for(let id in p) { l.innerHTML += `<div class="bg-slate-800 p-4 rounded-2xl border border-slate-700 flex gap-4 items-center shadow-lg"><img src="${p[id].img}" class="w-16 h-16 rounded-xl object-cover"><div class="flex-1 font-bold text-sm">${p[id].cat||'ä¸€èˆ¬'} / ${p[id].name}<br><span class="text-yellow-500 text-lg">${p[id].price} PTS</span></div><button onclick="edit('${id}','${p[id].cat}','${p[id].name}',${p[id].price},'${p[id].img}','${p[id].desc}')" class="text-blue-400 text-xs mr-2">ç·¨è¼¯</button><button onclick="if(confirm('åˆªé™¤ï¼Ÿ')) db.ref('products/${id}').remove()" class="text-red-500 text-xs">åˆªé™¤</button></div>`; } });
        }
        function adj(uid) { const v = parseInt(document.getElementById(`in-${uid}`).value); if(isNaN(v)) return; db.ref(`users/${uid}/points`).transaction(p => (p||0)+v, (e,c,snap) => { if(c) { const change = (v > 0 ? "+" : "") + v; fetch(`${GAS_URL}?userId=${uid}&msg=${encodeURIComponent(change)}`, {mode:'no-cors'}); document.getElementById(`in-${uid}`).value = ''; } }); }
        function save() { const id = document.getElementById('editId').value; const data = { cat: document.getElementById('pCat').value || 'ä¸€èˆ¬', name: document.getElementById('pName').value, price: parseInt(document.getElementById('pPrice').value), img: document.getElementById('pImg').value, desc: document.getElementById('pDesc').value || '' }; if(id) db.ref('products/'+id).update(data); else db.ref('products').push(data); reset(); }
        function edit(id,c,n,p,i,d) { document.getElementById('editId').value = id; document.getElementById('pCat').value = c; document.getElementById('pName').value = n; document.getElementById('pPrice').value = p; document.getElementById('pImg').value = i; document.getElementById('pDesc').value = d || ''; document.getElementById('fTitle').innerText = "âœï¸ ç·¨è¼¯æ¨¡å¼"; }
        function reset() { document.getElementById('editId').value = ''; document.getElementById('pCat').value = ''; document.getElementById('pName').value = ''; document.getElementById('pPrice').value = ''; document.getElementById('pImg').value = ''; document.getElementById('pDesc').value = ''; document.getElementById('fTitle').innerText = "ğŸ å•†å“ç®¡ç†"; }
    </script>
</body>
</html>
