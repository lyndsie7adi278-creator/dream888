<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>豪華 3D 質感扭蛋機</title>
    <style>
        :root {
            --machine-red: #e74c3c;
            --machine-dark: #c0392b;
            --glass-shine: rgba(255, 255, 255, 0.4);
            --plastic-black: #2c3e50;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1a1a1a;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        /* 扭蛋機整體架構 */
        .gacha-system {
            position: relative;
            width: 380px;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.6));
        }

        /* 頂部護蓋 */
        .top-cap {
            width: 240px;
            height: 40px;
            background: var(--machine-red);
            border: 5px solid #fff;
            margin: 0 auto -10px;
            border-radius: 50px 50px 10px 10px;
            position: relative;
            z-index: 10;
            box-shadow: inset 0 5px 10px rgba(255,255,255,0.5);
        }

        /* 玻璃艙體 - 強化折射感 */
        .glass-chamber {
            width: 320px;
            height: 320px;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), rgba(255,255,255,0.05));
            border-radius: 50%;
            border: 8px solid #fff;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(2px);
            z-index: 5;
            box-shadow: 
                inset 0 0 60px rgba(0,0,0,0.3),
                0 0 20px rgba(255,255,255,0.1);
        }

        #physics-canvas { display: block; cursor: default; }

        /* 厚實的機身底座 */
        .machine-body {
            width: 340px;
            height: 280px;
            background: linear-gradient(to bottom, var(--machine-red), var(--machine-dark));
            border-radius: 20px 20px 50px 50px;
            margin: -60px auto 0;
            border: 6px solid #fff;
            position: relative;
            z-index: 2;
            box-shadow: inset 0 10px 20px rgba(255,255,255,0.3);
        }

        /* 投幣旋鈕區域 */
        .crank-panel {
            width: 160px;
            height: 160px;
            background: #ecf0f1;
            border-radius: 50%;
            border: 6px solid #95a5a6;
            margin: 50px auto 0;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.2), 0 5px 0 #bdc3c7;
        }

        .crank-handle {
            width: 100px;
            height: 100px;
            background: #bdc3c7;
            border-radius: 50%;
            border: 4px solid #7f8c8d;
            cursor: pointer;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crank-handle::after {
            content: '';
            width: 85%;
            height: 20px;
            background: #7f8c8d;
            border-radius: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        /* 出球口斜坡設計 */
        .exit-chute {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 110px;
            height: 80px;
            background: #1a1a1a;
            border-radius: 15px 15px 30px 30px;
            border-bottom: 8px solid #000;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.8);
        }

        /* 掉出來的大扭蛋球 */
        .out-ball {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #333;
            display: none;
            z-index: 100;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        /* 扭蛋球經典設計：透明上蓋 + 彩色下底 */
        .out-ball::before {
            content: ''; position: absolute; top: 0; width: 100%; height: 50%;
            background: rgba(255,255,255,0.4); border-bottom: 2px solid rgba(0,0,0,0.1);
        }
        .out-ball::after {
            content: ''; position: absolute; bottom: 0; width: 100%; height: 50%;
            background: var(--ball-color, #f00);
        }

        @keyframes ball-drop-physics {
            0% { transform: translate(-50%, -60px) scale(0); }
            50% { transform: translate(-50%, 30px) scale(1.1); }
            100% { transform: translate(-50%, 60px) scale(1) rotate(15deg); }
        }
        .is-dropped { display: block !important; left: 50%; animation: ball-drop-physics 0.5s forwards ease-out; }

        /* 彈窗 UI */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 1000; }
        .win-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 300px; background: #fff; border-radius: 40px; padding: 30px; text-align: center; z-index: 1001;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 8px solid var(--machine-red);
        }
        .win-modal.active { transform: translate(-50%, -50%) scale(1); }
        .win-modal h1 { color: var(--machine-red); font-size: 40px; margin: 10px 0; }
    </style>
</head>
<body>

<div class="gacha-system">
    <div class="top-cap"></div>
    <div class="glass-chamber">
        <canvas id="physics-canvas" width="320" height="320"></canvas>
    </div>
    <div class="machine-body">
        <div class="crank-panel">
            <div class="crank-handle" id="main-crank"></div>
        </div>
        <div class="exit-chute">
            <div id="final-ball" class="out-ball"></div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="overlay"></div>
<div class="win-modal" id="modal">
    <p style="font-weight: bold; color: #7f8c8d;">YOU GOT</p>
    <h1 id="prize-val">10 點</h1>
    <button onclick="resetGame()" style="background: var(--machine-red); color: white; border: none; padding: 12px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-top: 15px;">收下扭蛋</button>
</div>

<script>
    const canvas = document.getElementById('physics-canvas');
    const ctx = canvas.getContext('2d');
    const crank = document.getElementById('main-crank');
    const finalBall = document.getElementById('final-ball');
    const modal = document.getElementById('modal');
    const overlay = document.getElementById('overlay');

    const ballColors = ['#ff4d4d', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6', '#e67e22'];
    let balls = [];
    let isRolling = false;

    // 初始化 10 顆大球
    for(let i=0; i<10; i++) {
        balls.push({
            x: 100 + Math.random()*120, y: 200 + Math.random()*50,
            vx: 0, vy: 0, r: 28, // 增大球體半徑
            color: ballColors[i % ballColors.length]
        });
    }

    function drawBalls() {
        ctx.clearRect(0,0,320,320);
        balls.forEach(b => {
            ctx.save();
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
            ctx.clip();
            
            // 下半部：有色塑料感
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x - b.r, b.y, b.r*2, b.r);
            // 上半部：半透明罩感
            ctx.fillStyle = "rgba(255,255,255,0.5)";
            ctx.fillRect(b.x - b.r, b.y - b.r, b.r*2, b.r);
            
            // 增加光澤球體感
            let grad = ctx.createRadialGradient(b.x - 10, b.y - 10, 5, b.x, b.y, b.r);
            grad.addColorStop(0, 'rgba(255,255,255,0.4)');
            grad.addColorStop(1, 'rgba(0,0,0,0.2)');
            ctx.fillStyle = grad;
            ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();

            // 描邊
            ctx.strokeStyle = "rgba(0,0,0,0.3)"; ctx.lineWidth = 2; ctx.stroke();
            ctx.restore();
        });
    }

    function physicsLoop() {
        balls.forEach(b => {
            if(isRolling) {
                b.vx += (Math.random()-0.5)*20;
                b.vy += (Math.random()-0.5)*20;
            } else {
                b.vy += 0.8;
            }
            b.x += b.vx; b.y += b.vy;
            b.vx *= 0.96; b.vy *= 0.96;

            const dx = b.x - 160, dy = b.y - 160;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if(dist + b.r > 152) {
                const angle = Math.atan2(dy, dx);
                b.x = 160 + Math.cos(angle)*(152 - b.r);
                b.y = 160 + Math.sin(angle)*(152 - b.r);
                b.vx *= -0.6; b.vy *= -0.6;
            }
        });
        drawBalls();
        requestAnimationFrame(physicsLoop);
    }

    crank.onclick = () => {
        if(isRolling) return;
        isRolling = true;
        crank.style.transform = 'rotate(720deg)';
        finalBall.classList.remove('is-dropped');

        setTimeout(() => {
            isRolling = false;
            crank.style.transform = 'rotate(0deg)';
            const winColor = ballColors[Math.floor(Math.random()*ballColors.length)];
            finalBall.style.setProperty('--ball-color', winColor);
            finalBall.classList.add('is-dropped');
        }, 2000);
    };

    finalBall.onclick = () => {
        const prizes = ['5 點', '10 點', '20 點', '大獎 100 點'];
        document.getElementById('prize-val').innerText = prizes[Math.floor(Math.random()*prizes.length)];
        overlay.style.display = 'block';
        modal.classList.add('active');
    };

    function resetGame() {
        overlay.style.display = 'none';
        modal.classList.remove('active');
        finalBall.classList.remove('is-dropped');
    }

    physicsLoop();
</script>

</body>
</html>
