<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>豪華電玩街機風扭蛋機</title>
    <style>
        :root {
            --frame-metal: #4a4e69;
            --panel-blue: #22333b;
            --accent-pink: #ff4d6d;
            --neon-glow: 0 0 15px rgba(255, 77, 109, 0.8);
            --machine-width: 360px;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #0b0c10;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        /* 整個機台的外殼層次 */
        .arcade-gacha {
            position: relative;
            width: var(--machine-width);
            background: var(--frame-metal);
            padding: 15px;
            border-radius: 20px;
            border: 4px solid #1f2833;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9), inset 0 0 20px rgba(255,255,255,0.1);
        }

        /* 頂部裝飾燈箱 */
        .machine-header {
            width: 100%;
            height: 50px;
            background: #1f2833;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 4px solid var(--accent-pink);
            box-shadow: var(--neon-glow);
        }

        .header-text {
            color: #fff;
            font-weight: bold;
            letter-spacing: 5px;
            text-shadow: var(--neon-glow);
        }

        /* 強化版透明圓艙 */
        .glass-chamber {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), rgba(0,0,0,0.3));
            border: 8px solid #c5c6c7;
            border-radius: 50%;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(2px);
            z-index: 5;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        #physics-canvas { display: block; }

        /* 中間機械面板 */
        .control-section {
            width: 100%;
            height: 200px;
            background: var(--panel-blue);
            margin-top: -50px;
            border-radius: 0 0 15px 15px;
            border: 3px solid #000;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 側面散熱孔裝飾 */
        .vents {
            position: absolute;
            left: 15px;
            top: 60px;
            width: 40px;
            height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .vent-line { width: 100%; height: 4px; background: #000; border-radius: 2px; opacity: 0.5; }

        /* 核心旋鈕 */
        .crank-base {
            width: 110px;
            height: 110px;
            background: #c5c6c7;
            border-radius: 50%;
            margin-top: 40px;
            border: 6px solid #1f2833;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 0 #45a29e;
        }
        .crank-base:active { transform: scale(0.9) rotate(360deg); box-shadow: 0 2px 0 #45a29e; }

        .handle {
            width: 80px;
            height: 25px;
            background: var(--accent-pink);
            border-radius: 12px;
            border: 3px solid #000;
        }

        /* 出球口 - 深度感 */
        .dispenser {
            position: absolute;
            bottom: 15px;
            right: 25px;
            width: 100px;
            height: 80px;
            background: #000;
            border-radius: 15px;
            border: 4px solid #45a29e;
            overflow: visible;
        }

        /* 掉出來的雙色球 */
        .gacha-ball {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #000;
            display: none;
            z-index: 20;
            cursor: pointer;
            overflow: hidden;
        }
        .gacha-ball::before { content: ''; position: absolute; top: 0; width: 100%; height: 50%; background: var(--ball-color, #f00); }
        .gacha-ball::after { content: ''; position: absolute; bottom: 0; width: 100%; height: 50%; background: #fff; }

        @keyframes ball-out {
            0% { transform: translate(-50%, -50px) scale(0) rotate(0); opacity: 0; }
            50% { transform: translate(-50%, 20px) scale(1.1) rotate(180deg); opacity: 1; }
            100% { transform: translate(-50%, 40px) scale(1) rotate(360deg); opacity: 1; filter: drop-shadow(0 5px 10px rgba(255,77,109,0.5)); }
        }
        .dropped { display: block !important; left: 50%; animation: ball-out 0.6s forwards; }

        /* 開獎 UI */
        .prize-ui {
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 300px; background: #1f2833; border: 4px solid var(--accent-pink);
            border-radius: 20px; color: #fff; text-align: center; padding: 40px;
            z-index: 100; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 50px rgba(0,0,0,0.8), var(--neon-glow);
        }
        .prize-ui.active { transform: translate(-50%, -50%) scale(1); }
        .prize-ui h1 { color: var(--accent-pink); margin: 20px 0; }
        .btn-claim { background: var(--accent-pink); border: none; padding: 10px 30px; border-radius: 5px; color: #fff; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="arcade-gacha">
    <div class="machine-header">
        <div class="header-text">LUCKY GACHA</div>
    </div>

    <div class="glass-chamber">
        <canvas id="physics-canvas" width="300" height="300"></canvas>
    </div>

    <div class="control-section">
        <div class="vents">
            <div class="vent-line"></div><div class="vent-line"></div><div class="vent-line"></div><div class="vent-line"></div>
        </div>

        <div class="crank-base" id="crank-btn">
            <div class="handle"></div>
        </div>
        
        <p style="color: #45a29e; font-size: 12px; font-weight: bold; margin-top: 10px;">TURN TO PLAY</p>

        <div class="dispenser">
            <div id="out-ball" class="gacha-ball"></div>
        </div>
    </div>
</div>

<div class="prize-ui" id="prize-modal">
    <p>SPECIAL PRIZE</p>
    <h1 id="prize-name">10 POINTS</h1>
    <button class="btn-claim" onclick="closePrize()">CLAIM</button>
</div>

<script>
    const canvas = document.getElementById('physics-canvas');
    const ctx = canvas.getContext('2d');
    const crank = document.getElementById('crank-btn');
    const outBall = document.getElementById('out-ball');
    const prizeModal = document.getElementById('prize-modal');

    const colors = ['#ff4d6d', '#ffb703', '#8ecae6', '#219ebc', '#fb8500', '#06d6a0', '#ef476f'];
    let balls = [];
    let isSpinning = false;

    // 初始化物理球
    for(let i=0; i<15; i++) {
        balls.push({
            x: 100 + Math.random()*100, y: 200 + Math.random()*50,
            vx: 0, vy: 0, r: 20,
            color: colors[i % colors.length]
        });
    }

    function draw() {
        ctx.clearRect(0,0,300,300);
        balls.forEach(b => {
            ctx.save();
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
            ctx.clip();
            // 繪製雙色
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x - b.r, b.y - b.r, b.r*2, b.r);
            ctx.fillStyle = "#fff";
            ctx.fillRect(b.x - b.r, b.y, b.r*2, b.r);
            // 描邊
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
            ctx.strokeStyle = "#000"; ctx.lineWidth = 2; ctx.stroke();
            ctx.restore();
        });
    }

    function update() {
        balls.forEach(b => {
            if(isSpinning) {
                b.vx += (Math.random()-0.5)*18;
                b.vy += (Math.random()-0.5)*18;
            } else {
                b.vy += 0.8; // 重力
            }
            b.x += b.vx; b.y += b.vy;
            b.vx *= 0.95; b.vy *= 0.95;

            // 圓艙碰撞
            const dx = b.x - 150, dy = b.y - 150;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if(dist + b.r > 142) {
                const angle = Math.atan2(dy, dx);
                b.x = 150 + Math.cos(angle)*(142 - b.r);
                b.y = 150 + Math.sin(angle)*(142 - b.r);
                b.vx *= -0.7; b.vy *= -0.7;
            }
        });
        draw();
        requestAnimationFrame(update);
    }

    crank.onclick = () => {
        if(isSpinning) return;
        isSpinning = true;
        outBall.classList.remove('dropped');
        
        setTimeout(() => {
            isSpinning = false;
            const winColor = colors[Math.floor(Math.random()*colors.length)];
            outBall.style.setProperty('--ball-color', winColor);
            outBall.classList.add('dropped');
        }, 1800);
    };

    outBall.onclick = () => {
        const p = ['5 點', '10 點', '20 點', '再玩一次', '神秘獎品'];
        document.getElementById('prize-name').innerText = p[Math.floor(Math.random()*p.length)];
        prizeModal.classList.add('active');
    };

    function closePrize() {
        prizeModal.classList.remove('active');
        outBall.classList.remove('dropped');
    }

    update();
</script>

</body>
</html>
