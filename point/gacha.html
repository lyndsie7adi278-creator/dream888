<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ„›é¢¨ç‰©ç†æ‰­è›‹æ©Ÿ</title>
    <style>
        :root {
            --pink-main: #ff85a2;
            --pink-light: #ffb3c6;
            --blue-base: #70d6ff;
            --white: #ffffff;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fff5f7;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .gacha-container {
            position: relative;
            width: 360px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* é ‚éƒ¨ç²‰è‰²è“‹å­ */
        .machine-cap {
            width: 180px;
            height: 30px;
            background: var(--pink-main);
            border-radius: 15px 15px 5px 5px;
            border: 4px solid #444;
            z-index: 3;
        }

        /* é€æ˜åœ“å½¢ç»ç’ƒè‰™ */
        .glass-dome {
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.6);
            border: 6px solid #444;
            border-radius: 50%;
            position: relative;
            margin-top: -10px;
            z-index: 2;
            overflow: hidden;
            box-shadow: inset -10px 10px 20px rgba(255,255,255,0.8);
        }

        /* Canvas ç”¨ä¾†è™•ç†ç‰©ç†çƒ */
        #physics-canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* ä¸‹æ–¹æ©Ÿèº« */
        .machine-body {
            width: 280px;
            height: 220px;
            background: var(--blue-base);
            border: 6px solid #444;
            border-radius: 20px 20px 60px 60px;
            margin-top: -40px;
            z-index: 1;
            position: relative;
            box-shadow: 0 10px 0 #4da3ce;
        }

        /* æ—‹éˆ• */
        .crank-area {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: #fff;
            border: 4px solid #444;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .crank-handle {
            width: 80%;
            height: 20px;
            background: var(--pink-main);
            border-radius: 10px;
            border: 3px solid #444;
        }

        /* å‡ºçƒå£ */
        .exit-hole {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 70px;
            background: #444;
            border-radius: 10px 10px 30px 30px;
        }

        /* æ‰å‡ºä¾†çš„çƒ */
        .out-ball {
            position: absolute;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 3px solid #444;
            display: none;
            z-index: 10;
            cursor: pointer;
            overflow: hidden;
        }
        
        /* é›™è‰²çƒæ¨£å¼ */
        .out-ball::before {
            content: '';
            position: absolute;
            top: 0; width: 100%; height: 50%;
            background: var(--ball-color, #ff4757);
        }
        .out-ball::after {
            content: '';
            position: absolute;
            bottom: 0; width: 100%; height: 50%;
            background: #fff;
        }

        @keyframes ball-drop {
            0% { transform: translate(-50%, -100px) scale(0); }
            100% { transform: translate(-50%, 20px) scale(1) rotate(20deg); }
        }
        .drop-active { display: block !important; animation: ball-drop 0.5s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* é–‹çå½ˆçª— */
        .prize-modal {
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 260px; background: #fff; border: 6px solid var(--pink-main);
            border-radius: 30px; padding: 20px; text-align: center; z-index: 100;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .prize-modal.show { transform: translate(-50%, -50%) scale(1); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 99; }
    </style>
</head>
<body>

<div class="gacha-container">
    <div class="machine-cap"></div>
    <div class="glass-dome">
        <canvas id="physics-canvas" width="300" height="300"></canvas>
    </div>
    <div class="machine-body">
        <div class="crank-area" id="crank">
            <div class="crank-handle"></div>
        </div>
        <div class="exit-hole">
            <div id="result-ball" class="out-ball" style="left: 50%;"></div>
        </div>
    </div>
</div>

<div class="overlay" id="overlay"></div>
<div class="prize-modal" id="modal">
    <h3 style="color: #ff85a2; margin: 10px 0;">ğŸ‰ æ­å–œä¸­ç ğŸ‰</h3>
    <h1 id="prize-name" style="color: #444; margin: 10px 0;">5 é»</h1>
    <button onclick="closeModal()" style="background: var(--blue-base); border: none; padding: 10px 20px; border-radius: 20px; color: white; cursor: pointer; font-weight: bold;">å¤ªæ£’äº†ï¼</button>
</div>

<script>
    const canvas = document.getElementById('physics-canvas');
    const ctx = canvas.getContext('2d');
    const crank = document.getElementById('crank');
    const resultBall = document.getElementById('result-ball');
    const modal = document.getElementById('modal');
    const overlay = document.getElementById('overlay');

    const ballColors = ['#FFADAD', '#FFD6A5', '#FDFFB6', '#CAFFBF', '#9BFBC0', '#A0C4FF', '#BDB2FF', '#FFC6FF'];
    let balls = [];
    let isSpinning = false;

    // åˆå§‹åŒ–çƒ
    function initBalls() {
        for (let i = 0; i < 12; i++) {
            balls.push({
                x: 100 + Math.random() * 100,
                y: 200 + Math.random() * 50,
                vx: 0,
                vy: 0,
                radius: 22,
                color: ballColors[i % ballColors.length]
            });
        }
    }

    function drawBalls() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        balls.forEach(ball => {
            // ç¹ªè£½é›™è‰²çƒ
            ctx.save();
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.clip();
            
            // ä¸ŠåŠéƒ¨é¡è‰²
            ctx.fillStyle = ball.color;
            ctx.fillRect(ball.x - ball.radius, ball.y - ball.radius, ball.radius * 2, ball.radius);
            // ä¸‹åŠéƒ¨ç™½è‰²
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(ball.x - ball.radius, ball.y, ball.radius * 2, ball.radius);
            
            // æé‚Š
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.lineWidth = 3;
            ctx.strokeStyle = "#444";
            ctx.stroke();
            ctx.restore();
        });
    }

    function updatePhysics() {
        balls.forEach(ball => {
            if (isSpinning) {
                ball.vx += (Math.random() - 0.5) * 15;
                ball.vy += (Math.random() - 0.5) * 15;
            } else {
                ball.vy += 0.8; // é‡åŠ›
            }

            ball.x += ball.vx;
            ball.y += ball.vy;
            ball.vx *= 0.95; // é˜»åŠ›
            ball.vy *= 0.95;

            // åœ“å½¢è‰™ç¢°æ’æª¢æ¸¬
            const dx = ball.x - 150;
            const dy = ball.y - 150;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist + ball.radius > 145) {
                const angle = Math.atan2(dy, dx);
                ball.x = 150 + Math.cos(angle) * (145 - ball.radius);
                ball.y = 150 + Math.sin(angle) * (145 - ball.radius);
                ball.vx *= -0.6; // åå½ˆæè€—
                ball.vy *= -0.6;
            }
        });
        drawBalls();
        requestAnimationFrame(updatePhysics);
    }

    crank.addEventListener('click', () => {
        if (isSpinning) return;
        isSpinning = true;
        crank.style.transform = 'translateX(-50%) rotate(720deg)';
        resultBall.classList.remove('drop-active');

        setTimeout(() => {
            isSpinning = false;
            crank.style.transform = 'translateX(-50%) rotate(0deg)';
            
            // éš¨æ©Ÿé¸ä¸€å€‹é¡è‰²æ‰å‡º
            const winColor = ballColors[Math.floor(Math.random() * ballColors.length)];
            resultBall.style.setProperty('--ball-color', winColor);
            resultBall.classList.add('drop-active');
        }, 2000);
    });

    resultBall.addEventListener('click', () => {
        const prizes = ['3 é»', '5 é»', '10 é»', 'è¶…ç´šå¤§çï¼'];
        document.getElementById('prize-name').innerText = prizes[Math.floor(Math.random() * prizes.length)];
        overlay.style.display = 'block';
        modal.classList.add('show');
    });

    function closeModal() {
        overlay.style.display = 'none';
        modal.classList.remove('show');
        resultBall.classList.remove('drop-active');
    }

    initBalls();
    updatePhysics();
</script>

</body>
</html>
