<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
    <title>å¤¢å·¥å»  | åˆ®åˆ®æ¨‚å•†åŸ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        :root{--primary:#ff8fa3;--dark:#1a1c23;--bg:#f0f2f5;--line:#06c755;--soldout:#95a5a6;--free:#4cd137;--lock:#3498db;--gold:#ffb800}
        * {-webkit-tap-highlight-color:transparent;user-select:none!important;box-sizing:border-box}
        body{font-family:'PingFang TC','Microsoft JhengHei',sans-serif;background:var(--bg);margin:0;padding:0;display:flex;flex-direction:column;align-items:center;overflow-x:hidden;padding-bottom:100px}
        .welcome-toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);background:rgba(26,28,35,.95);color:var(--gold);padding:12px 25px;border-radius:50px;font-weight:900;font-size:.9rem;z-index:5000;box-shadow:0 10px 30px rgba(0,0,0,.3);border:1px solid var(--gold);display:none;opacity:0;transition:.5s}
        .welcome-toast.show{display:block;opacity:1;transform:translateX(-50%) translateY(0)}
        .top-nav{width:100%;background:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 15px rgba(0,0,0,.08);position:sticky;top:0;z-index:1000}
        .nav-left{display:flex;align-items:center;gap:15px;cursor:pointer;color:#333;font-size:1.4rem;position:relative}
        
        /* ğŸŸ¢ ä¿®æ”¹ï¼šç¢ºä¿ Logo å®¹å™¨çµ•å°ç½®ä¸­ */
        .logo-txt{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:flex;align-items:center;justify-content:center}
        .logo-img{height:35px;width:auto;display:block;object-fit:contain}

        .menu-dropdown{display:none;position:absolute;top:60px;left:15px;background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.15);z-index:2000;min-width:150px;overflow:hidden;border:1px solid #eee}
        .menu-dropdown.show{display:block;animation:menuFade .3s ease}@keyframes menuFade{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .menu-item{padding:15px 20px;font-size:.9rem;color:#2c3e50;font-weight:700;border-bottom:1px solid #f9f9f9;display:flex;align-items:center;gap:10px;cursor:pointer;text-decoration:none}
        .menu-item:active{background:#fff1f3;color:var(--primary)}
        
        .marquee-container{width:100%;background:#1a1c23;color:var(--primary);padding:12px 0;overflow:hidden;white-space:nowrap;font-size:.85rem;font-weight:700;border-bottom:2px solid var(--primary);position: relative;}
        .marquee-content{display:inline-block;padding-left: 100%;animation: marquee-linear 40s linear infinite;will-change: transform;}
        @keyframes marquee-linear { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        @media screen and (max-width: 768px) { .marquee-content { animation-duration: 30s; } }

        .category-scroll{display:flex;overflow-x:auto;padding:15px 20px;gap:12px;width:100%;scrollbar-width:none;-webkit-overflow-scrolling:touch}
        .cat-item{flex-shrink:0;padding:10px 22px;border-radius:50px;background:#fff;border:1px solid #eee;font-size:.85rem;color:#7f8c8d;font-weight:700;transition:.3s;cursor:pointer}
        .cat-item.active{background:var(--primary);color:#fff;border-color:var(--primary);box-shadow:0 4px 12px rgba(255,143,163,.4)}
        .product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px;width:94%;max-width:500px;padding:15px 0}
        .p-card{background:#fff;border-radius:22px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.06);border:1px solid #f0f0f0;transition:.3s;position:relative;cursor:pointer}
        .p-card:active{transform:scale(.95)}
        .p-card.soldout{filter:grayscale(.8);opacity:.8}
        .p-card.free-gift{border:2px solid var(--free);box-shadow:0 8px 25px rgba(76,209,55,.4)}
        .p-img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#fdfdfd}
        .p-info{padding:18px 10px;text-align:center;min-height:115px;display:flex;flex-direction:column;justify-content:center;align-items:center}
        .p-name{font-weight:900;font-size:.95rem;color:#2c3e50;margin-bottom:5px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .p-price-value{color:var(--primary);font-weight:900;font-size:1.15rem;display:flex;align-items:center;justify-content:center;gap:5px}
        .soldout-tag{background:#57606f;color:#fff;font-size:.7rem;padding:4px 10px;border-radius:6px;margin-top:5px;display:inline-block;font-weight:900}
        .free-tag{background:var(--free);color:#fff;font-size:.7rem;padding:4px 10px;border-radius:6px;margin-top:5px;display:inline-block;font-weight:900}
        .lock-tag{background:var(--lock);color:#fff;font-size:.7rem;padding:4px 10px;border-radius:6px;margin-top:5px;display:inline-block;font-weight:900}
        .promo-tag{background:#ff4757;color:#fff;font-size:.6rem;padding:2px 6px;border-radius:4px;font-weight:900}
        .promo-info{font-size:.65rem;color:#ff8fa3;margin-top:5px;font-weight:900}
        .line-wrapper{position:fixed;bottom:30px;right:20px;z-index:2000;display:flex;flex-direction:column;align-items:flex-end;animation:float-breath 2s infinite ease-in-out}
        .line-bubble{background:#fff;color:#333;padding:10px 15px;border-radius:15px;font-size:.8rem;font-weight:900;margin-bottom:10px;box-shadow:0 5px 15px rgba(0,0,0,.15);position:relative;border:1px solid #eee;white-space:nowrap}
        .line-bubble::after{content:"";position:absolute;bottom:-8px;right:20px;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #fff}
        .line-float{width:60px;height:60px;background:var(--line);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 25px rgba(6,199,85,.4);cursor:pointer}
        .line-float img{width:35px;height:35px}@keyframes float-breath{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        .status-section{width:92%;max-width:460px;margin:35px 0 15px;background:#fff;border-radius:28px;padding:25px;border:1px solid rgba(0,0,0,.04);box-shadow:0 5px 20px rgba(0,0,0,.03)}
        .status-item{display:flex;align-items:flex-start;background:#f9fafb;padding:18px;border-radius:20px;margin-bottom:15px}.status-icon{font-size:1.6rem;margin-right:18px;margin-top:3px}
        .status-text b{display:block;font-size:.9rem;color:#1a1c23;margin-bottom:5px}.status-text p{margin:0;font-size:.75rem;color:#7f8c8d;line-height:1.6}
        
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:4000;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
        .m-box{background:#fff;padding:25px 15px;border-radius:35px;width:90%;max-width:360px;text-align:center;position:relative;box-shadow:0 20px 50px rgba(0,0,0,.3);overflow:hidden}
        .close-modal{position:absolute;top:15px;right:20px;font-size:1.5rem;color:#ccc;cursor:pointer;z-index:10}
        .swiper { width: 100%; height: auto; padding-bottom: 30px; }
        .pop-img-box { width: 100%; border-radius: 15px; overflow: hidden; margin-bottom: 15px; background: #f0f0f0; }
        .pop-img-box img { width: 100%; height: auto; display: block; object-fit: cover; }
        .pop-title { font-weight: 900; font-size: 1.1rem; color: #333; margin-bottom: 10px; }
        .pop-text { font-size: 0.9rem; color: #666; text-align: left; line-height: 1.6; white-space: pre-wrap; padding: 0 10px; }
        .swiper-pagination-bullet-active { background: var(--primary) !important; }
        
        input{width:100%;padding:14px;margin:8px 0;border:1px solid #eee;border-radius:12px;text-align:center;font-size:1rem;font-weight:700;color:var(--primary);outline:none}
        .btn{background:var(--primary);color:#fff;border:none;padding:16px;border-radius:50px;font-weight:900;width:100%;cursor:pointer;font-size:1rem;box-shadow:0 8px 20px rgba(255,143,163,.3);margin-top:10px}
        .footer{padding:30px 0 50px;font-size:.75rem;color:#95a5a6;text-align:center;line-height:2}

        .modal-footer { margin-top: 15px; border-top: 1px solid #f0f0f0; padding-top: 15px; }
        .no-show-label { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.85rem; color: #999; cursor: pointer; margin-bottom: 12px; }
        .no-show-label input { width: 16px; height: 16px; margin: 0; cursor: pointer; }
        .tip-text { font-size: 0.7rem; color: #ccc; margin-top: 8px; }
    </style>
</head>
<body oncontextmenu="return false;">
<div id="welcomeToast" class="welcome-toast"></div>
<div class="line-wrapper" onclick="window.open('https://line.me/ti/p/@dream8','_blank')"><div class="line-bubble">å„²å€¼/å•é¡Œè«‹é»æˆ‘ ğŸ’¬</div><div class="line-float"><img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" alt="LINE"></div></div>

<div id="annModal" class="modal">
    <div class="m-box">
        <div class="close-modal" onclick="closeModal()">âœ•</div>
        <div class="swiper mySwiper">
            <div class="swiper-wrapper" id="annSwiperWrapper"></div>
            <div class="swiper-pagination"></div>
        </div>
        
        <div class="modal-footer">
            <label class="no-show-label">
                <input type="checkbox" id="noMoreToday"> ä»Šæ—¥ä¸å†é¡¯ç¤º
            </label>
            <button class="btn" onclick="closeModal()">æˆ‘çŸ¥é“äº†</button>
            <div class="tip-text">ğŸ’¡ æº«é¦¨æç¤ºï¼šé»æ“Šå·¦ä¸Šè§’ã€Œâ˜° æœ€æ–°å…¬å‘Šã€å¯å†æ¬¡æŸ¥çœ‹</div>
        </div>
    </div>
</div>

<div class="top-nav">
    <div class="nav-left" id="menuToggle">
        <span>â˜°</span>
        <div class="menu-dropdown" id="menuDropdown">
            <div class="menu-item" onclick="openAnn()">ğŸ“œ æœ€æ–°å…¬å‘Š</div>
            <a href="faq.html" class="menu-item">â“ å¸¸è¦‹å•é¡Œ</a>
        </div>
    </div>
    
    <div class="logo-txt">
        <img src="https://firebasestorage.googleapis.com/v0/b/dream8-7b161.firebasestorage.app/o/images%2F%E6%9C%AA%E5%91%BD%E5%90%8D%E8%A8%AD%E8%A8%88%20(5).png?alt=media&token=1c7a2e9a-c1bb-465e-9a34-b179fbe98ce8" alt="Logo" class="logo-img">
    </div>
    
    <div id="userEntryPoint" onclick="handleUserClick()" style="cursor:pointer;font-size:1.4rem;color:#444">ğŸ‘¤</div>
</div>

<div class="marquee-container"><div class="marquee-content" id="mq">æ­£åœ¨åŒæ­¥æœ€æ–°ä¸­çå–œå ±...</div></div>
<div class="category-scroll" id="catList"><div class="cat-item active" onclick="filterCat('ALL')">å…¨éƒ¨å•†å“ ALL</div></div>
<div class="product-grid" id="pGrid"></div>
<div class="status-section"><div class="status-item"><div class="status-icon">ğŸ›¡ï¸</div><div class="status-text"><b>åŠ å¯†å®‰å…¨è¨ªå•ç³»çµ±</b><p>æ•¸æ“šç¶“ SSL é«˜ç´šåŠ å¯†ï¼Œå®ˆè­·è³‡ç”¢å®‰å…¨ã€‚</p></div></div><div class="status-item"><div class="status-icon">ğŸ°</div><div class="status-text"><b>å…¬å¹³éš¨æ©Ÿæ´—ç‰Œç®—æ³•</b><p>ç±¤æ± ç™¼ä½ˆå³éš¨æ©Ÿæ’åºï¼Œå…¬æ­£é€æ˜ã€‚</p></div></div></div>
<div class="footer"> Â© 2026 | å¤¢å·¥å»  </div>

<div id="loginModal" class="modal"><div class="m-box"><div class="close-modal" onclick="document.getElementById('loginModal').style.display='none'">âœ•</div><h2 id="loginStepTitle" style="margin:0 0 10px;letter-spacing:2px;font-size:1.2rem">æœƒå“¡ç™»å…¥</h2><div id="step1"><input type="text" id="cIn" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ (ID)"><button class="btn" onclick="checkCode()">ä¸‹ä¸€æ­¥ NEXT</button><p style="font-size:.7rem;color:var(--primary);margin-top:15px;cursor:pointer" onclick="showReg()">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿç«‹å³è¨»å†Š</p></div><div id="step2" style="display:none"><input type="password" id="pinIn" placeholder="è¼¸å…¥å¯†ç¢¼"><button class="btn" onclick="handlePinLogin()">ç¢ºèªç™»å…¥ ENTER</button><button class="btn" style="background:#eee;color:#666;margin-top:10px" onclick="backStep1()">å›ä¸Šä¸€æ­¥</button></div><div id="stepRegister" style="display:none;text-align:left"><p style="color:var(--primary);font-weight:700;text-align:center;margin-bottom:10px">âœ¨ å»ºç«‹æ–°å¸³è™Ÿ</p><input type="text" id="regId" placeholder="è¨­å®šç™»å…¥å¸³è™Ÿ"><input type="text" id="regNick" placeholder="è¨­å®šé¡¯ç¤ºæš±ç¨±"><input type="password" id="regPass1" placeholder="è¨­å®šå¯†ç¢¼"><input type="password" id="regPass2" placeholder="å†æ¬¡ç¢ºèªå¯†ç¢¼"><input type="text" id="refIn" placeholder="æ¨è–¦äººå¸³è™Ÿ (éå¿…å¡«)"><button class="btn" onclick="handleRegister()">ç¢ºèªè¨»å†Š REGISTER</button><p style="font-size:.7rem;color:#aaa;text-align:center;margin-top:10px;cursor:pointer" onclick="backStep1()">å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥</p></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {getDatabase,ref,onValue,get,update,set} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const _c = {Â 
Â  Â  apiKey: "AIzaSyDPGEIwCKyYxz6TYdxmkwAxIWjfQI8Awco",Â 
Â  Â  databaseURL: "https://dream8-7b161-default-rtdb.firebaseio.com",Â 
Â  Â  projectId: "dream8-7b161",Â 
Â  Â  appId: "1:606218522479:web:2737643db3de735af7e29a"Â 
};

const _app=initializeApp(_c);
const _db=getDatabase(_app);
const _sk=localStorage.getItem('myScratchCode');
let _g={},_cc='ALL',_u=null;

// ğŸ”´ å¼·åŒ–ï¼šæ•æ‰ç¶²å€åƒæ•¸ä¸¦å­˜å…¥ localStorage
(function captureRef() {
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const refId = urlParams.get('ref');
Â  Â  if (refId && refId.trim() !== "") {
Â  Â  Â  Â  localStorage.setItem('pending_ref', refId.trim());
Â  Â  }
})();

const _mt=document.getElementById('menuToggle'),_md=document.getElementById('menuDropdown');
_mt.onclick=(e)=>{e.stopPropagation();_md.classList.toggle('show')};
window.onclick=()=>_md.classList.remove('show');

window.openAnn=()=>{
Â  Â  document.getElementById('annModal').style.display='flex';
Â  Â  _md.classList.remove('show');
};

window.handleUserClick = () => {
Â  Â  if(_sk) { location.href = 'profile.html'; } else { openLogin(); }
};

window.openLogin=()=>{document.getElementById('loginModal').style.display='flex';backStep1()};
window.showWelcomeToast=(n)=>{const t=document.getElementById('welcomeToast');t.innerText=`âœ¨ æ­¡è¿å›ä¾†ï¼Œ${n}ï¼`;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500)};

function init(){
Â  Â  onValue(ref(_db, 'winLogs'), (snapshot) => {
Â  Â  Â  Â  const winData = snapshot.val();
Â  Â  Â  Â  let winText = "";
Â  Â  Â  Â  if (winData) {
Â  Â  Â  Â  Â  Â  const sortedWins = Object.values(winData).sort((a, b) => (b.time || 0) - (a.time || 0)).slice(0, 5);
Â  Â  Â  Â  Â  Â  winText = sortedWins.map(w => `ğŸŠ æ­å–œç©å®¶ ã€${w.user}ã€‘ åœ¨ã€Š${w.game}ã€‹åˆ®ä¸­ ã€${w.prize}ã€‘ï¼ï¼`).join(' ã€€ | ã€€ ');
Â  Â  Â  Â  }
Â  Â  Â  Â  get(ref(_db, 'settings/announcement')).then(annSnap => {
Â  Â  Â  Â  Â  Â  const staticAnn = annSnap.val() || "ç¥å„ä½ç©å®¶éƒ½èƒ½åˆ®ä¸­ï¼å¥½é‹é€£é€£ï¼";
Â  Â  Â  Â  Â  Â  const finalContent = winText ? `${winText} ã€€ | ã€€ ğŸ“¢ å…¬å‘Šï¼š${staticAnn}` : staticAnn;
Â  Â  Â  Â  Â  Â  const mq = document.getElementById('mq');
Â  Â  Â  Â  Â  Â  mq.innerText = finalContent;
Â  Â  Â  Â  Â  Â  const duration = Math.max(25, Math.floor(finalContent.length * 0.3));
Â  Â  Â  Â  Â  Â  mq.style.animationDuration = duration + 's';
Â  Â  Â  Â  });
Â  Â  });

Â  Â  onValue(ref(_db,'settings/announcement_config'), s => {
Â  Â  Â  Â  if(s.exists()){
Â  Â  Â  Â  Â  Â  const config = s.val();
Â  Â  Â  Â  Â  Â  const wrapper = document.getElementById('annSwiperWrapper');
Â  Â  Â  Â  Â  Â  wrapper.innerHTML = "";Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(config.active && config.items && config.items.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  config.items.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const slide = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  slide.className = 'swiper-slide';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  slide.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.img ? `<div class="pop-img-box"><img src="${item.img}"></div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pop-title">${item.title}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pop-text">${item.content}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wrapper.appendChild(slide);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  new Swiper(".mySwiper", {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pagination: { el: ".swiper-pagination", clickable: true },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autoHeight: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  observer: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  observeParents: true
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const lastHideDate = localStorage.getItem('hide_ann_date');
Â  Â  Â  Â  Â  Â  Â  Â  const lastAnnId = localStorage.getItem('last_ann_id');
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date().toDateString();

Â  Â  Â  Â  Â  Â  Â  Â  if(lastAnnId !== config.id || lastHideDate !== today) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('annModal').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });

Â  Â  onValue(ref(_db,'gameSettings'),s=>{_g=s.val()||{};renderCats();renderGrid()});
Â  Â  if(_sk){
Â  Â  Â  Â  onValue(ref(_db,`users/${_sk}`),s=>{
Â  Â  Â  Â  Â  Â  const u=s.val(); if(!u)return;
Â  Â  Â  Â  Â  Â  if(!sessionStorage.getItem('welcomed')){showWelcomeToast(u.nickname||'ç©å®¶');sessionStorage.setItem('welcomed','1')}
Â  Â  Â  Â  });
Â  Â  }
}

window.closeModal = () => {
Â  Â  const isChecked = document.getElementById('noMoreToday').checked;
Â  Â  const today = new Date().toDateString();
Â  Â Â 
Â  Â  if (isChecked) {
Â  Â  Â  Â  localStorage.setItem('hide_ann_date', today);
Â  Â  } else {
Â  Â  Â  Â  localStorage.removeItem('hide_ann_date');
Â  Â  }

Â  Â  get(ref(_db,'settings/announcement_config')).then(s => {
Â  Â  Â  Â  if(s.exists()) localStorage.setItem('last_ann_id', s.val().id);
Â  Â  });

Â  Â  document.getElementById('annModal').style.display = 'none';
};

window.showReg=()=>{
Â  Â  document.getElementById('step1').style.display='none';
Â  Â  document.getElementById('stepRegister').style.display='block';
Â  Â  document.getElementById('loginStepTitle').innerText="è¨»å†Šæ–°å¸³è™Ÿ";
Â  Â Â 
    // ğŸ”´ é—œéµé»ï¼šåœ¨é¡¯ç¤ºè¨»å†Šä»‹é¢å¾Œï¼Œç¢ºä¿ refIn è¼¸å…¥æ¡†è¢«è³¦å€¼
Â  Â  setTimeout(() => {
Â  Â  Â  Â  const savedRef = localStorage.getItem('pending_ref');
Â  Â  Â  Â  const refEl = document.getElementById('refIn');
Â  Â  Â  Â  if (savedRef && refEl) {
Â  Â  Â  Â  Â  Â  refEl.value = savedRef;
Â  Â  Â  Â  Â  Â  // è§¸ç™¼ä¸€å€‹ input äº‹ä»¶è®“ç€è¦½å™¨æ„ŸçŸ¥
Â  Â  Â  Â  Â  Â  refEl.dispatchEvent(new Event('input', { bubbles: true }));
Â  Â  Â  Â  }
Â  Â  }, 100);
};

window.backStep1=()=>{document.getElementById('step1').style.display='block';document.getElementById('step2').style.display='none';document.getElementById('stepRegister').style.display='none';document.getElementById('loginStepTitle').innerText="æœƒå“¡ç™»å…¥"};
window.checkCode=async()=>{const c=document.getElementById('cIn').value.trim();if(!c)return;const s=await get(ref(_db,`users/${c}`));if(!s.exists())return alert("å¸³è™Ÿä¸å­˜åœ¨");_u={id:c,data:s.val()};document.getElementById('step1').style.display='none';document.getElementById('step2').style.display='block'};

window.handleRegister=async()=>{
    // ğŸ”´ çµ‚æ¥µä¿éšªï¼šé»æ“Šè¨»å†ŠæŒ‰éˆ•æ™‚ï¼Œå¦‚æœæ¨è–¦æ¬„æ˜¯ç©ºçš„ï¼Œç«‹åˆ»å¾ localStorage è£œæŠ“
    const refInput = document.getElementById('refIn');
    if(refInput && !refInput.value.trim()){
        const cached = localStorage.getItem('pending_ref');
        if(cached) refInput.value = cached;
    }

Â  Â  const i=document.getElementById('regId').value.trim(),
Â  Â  Â  Â  Â  n=document.getElementById('regNick').value.trim(),
Â  Â  Â  Â  Â  p1=document.getElementById('regPass1').value,
Â  Â  Â  Â  Â  p2=document.getElementById('regPass2').value,
          r=document.getElementById('refIn').value.trim();

Â  Â  if(!i||!n||!p1||!p2) return alert("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½");
Â  Â  if(p1!==p2) return alert("å¯†ç¢¼ä¸ä¸€è‡´");
Â  Â  if(i===r) return alert("æ¨è–¦äººä¸èƒ½æ˜¯è‡ªå·±");
Â  Â  const ex=await get(ref(_db,`users/${i}`));
Â  Â  if(ex.exists()) return alert("å¸³è™Ÿå·²å­˜åœ¨");
Â  Â  if(r !== "") {
Â  Â  Â  Â  const rs=await get(ref(_db,`users/${r}`));
Â  Â  Â  Â  if(!rs.exists()) return alert("æ¨è–¦äººå¸³è™Ÿä¸å­˜åœ¨ï¼Œè«‹ç¢ºèªæˆ–ç•™ç©º");
Â  Â  }
Â  Â  await set(ref(_db,`users/${i}`),{
Â  Â  Â  Â  balance: 0, commission: 0, nickname: n, pin: p1, invitedBy: r, hasToppedUp: false, createTime: Date.now()
Â  Â  });
Â  Â  localStorage.setItem('myScratchCode',i);
Â  Â  localStorage.removeItem('pending_ref');Â 
Â  Â  alert("è¨»å†ŠæˆåŠŸï¼");
Â  Â  location.reload();
};

window.handlePinLogin=async()=>{const p=document.getElementById('pinIn').value;if(_u.data.pin!==p)return alert("å¯†ç¢¼éŒ¯èª¤");localStorage.setItem('myScratchCode',_u.id);location.reload()};

function renderCats(){const c=new Set(['ALL']);Object.values(_g).forEach(i=>{if(i.category)c.add(i.category)});document.getElementById('catList').innerHTML=Array.from(c).map(i=>`<div class="cat-item ${_cc===i?'active':''}" onclick="filterCat('${i}')">${i==='ALL'?'å…¨éƒ¨':i}</div>`).join('')}
window.filterCat=c=>{_cc=c;renderCats();renderGrid()};

function renderGrid(){
Â  Â  const grid=document.getElementById('pGrid');grid.innerHTML='';
Â  Â  if(_cc==='ALL'){
Â  Â  Â  Â  const f=document.createElement('div');
Â  Â  Â  Â  f.className='p-card free-gift';
Â  Â  Â  Â  f.onclick=()=>window.open('https://www.dream888.fun/live/','_blank');
Â  Â  Â  Â  f.innerHTML=`<img src="https://i.ibb.co/VWVvG9fQ/0.png" class="p-img"><div class="p-info"><div class="p-name">ğŸ ç›´æ’­åˆ®åˆ®æ¨‚</div><div class="free-tag">FREE / é»æˆ‘</div></div>`;
Â  Â  Â  Â  grid.appendChild(f);
Â  Â  }
Â  Â  const keys=Object.keys(_g).sort((a,b)=>(_g[a].order||99)-(_g[b].order||99));
Â  Â  keys.forEach(id=>{
Â  Â  Â  Â  const it=_g[id]; if(_cc!=='ALL'&&it.category!==_cc)return;
Â  Â  Â  Â  const sId=id.replace(/\s+/g,'-');
Â  Â  Â  Â  const displayTitle = it.name || id;
Â  Â  Â  Â  const card=document.createElement('div');
Â  Â  Â  Â  card.className=`p-card ${it.isSoldOut?'soldout':''}`;
Â  Â  Â  Â  card.onclick=()=>location.href=`game.html?id=${id}`;
Â  Â  Â  Â  card.innerHTML=`<img src="${it.img||''}" class="p-img"><div class="p-info" id="info-${sId}"><div class="p-name" id="name-${sId}">${displayTitle}</div><div id="status-${sId}"></div><div id="promo-${sId}"></div></div>`;
Â  Â  Â  Â  grid.appendChild(card);
Â  Â  Â  Â  onValue(ref(_db,`games/${id}`),s=>{
Â  Â  Â  Â  Â  Â  const d=s.val()||{},l=d.lock,p=d.pool||[],sB=document.getElementById(`status-${sId}`),pB=document.getElementById(`promo-${sId}`);
Â  Â  Â  Â  Â  Â  if(!sB)return;
Â  Â  Â  Â  Â  Â  if(it.isSoldOut){sB.innerHTML=`<div class="soldout-tag">SOLD OUT / å·²åœç›¤</div>`;pB.innerHTML="";}
Â  Â  Â  Â  Â  Â  else if(l&&l.expire>Date.now()){sB.innerHTML=`<div class="lock-tag">ğŸ”’ ç©å®¶åŒ…å°ä¸­</div>`;pB.innerHTML="";}
Â  Â  Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  Â  Â  Â  const sold=p.filter(x=>x.taken).length;
Â  Â  Â  Â  Â  Â  Â  Â  if(it.promoCount>0&&sold<it.promoCount){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sB.innerHTML=`<div class="p-price-value">P${it.promoPrice} <span class="promo-tag">é–‹ç›¤å„ªæƒ </span></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pB.innerHTML=`<div class="promo-info">å‰${it.promoCount}åˆ® P${it.promoPrice} / å¾Œ P${it.price}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else{sB.innerHTML=`<div class="p-price-value">ä¸€åˆ® / P${it.price||0}</div>`;pB.innerHTML="";}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });
}
init();
</script>
</body>
</html>
